<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LARA Admin Panel</title>
<style>
body{
  font-family:Segoe UI;
  background:linear-gradient(120deg,#2a003f,#5e006e);
  color:white;
  padding:40px;
}
.container{max-width:900px;margin:auto;}
h1{color:#ffae00;text-align:center;margin-bottom:30px;}
form{
  background:rgba(255,255,255,0.1);
  padding:20px;border-radius:15px;
}
input,select{width:100%;padding:10px;margin-top:10px;border:none;border-radius:8px;}
button{margin-top:15px;padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.add-btn{background:#ff4fd8;color:black;}
.delete-btn{background:red;color:white;padding:5px 10px;font-size:0.8rem;}
table{width:100%;margin-top:30px;border-collapse:collapse;}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.2);}
.edit-btn{background:#ffae00;color:black;padding:5px 10px;font-size:0.8rem;}
#statusMessage{color:#ffae00;text-align:center;margin:15px 0;font-weight:bold;}
</style>
</head>
<body>
<div class="container">
<h1>Admin Panel - LARA Cosmetics</h1>

<div id="statusMessage"></div>

<form id="productForm">
<input type="hidden" id="productId">
<input type="text" id="name" placeholder="Product Name" required>
<input type="number" id="price" placeholder="Price" required>
<select id="category">
<option value="Skincare">Skincare</option>
<option value="Makeup">Makeup</option>
<option value="Perfume">Perfume</option>
<option value="Accessories">Accessories</option>
</select>
<input type="text" id="image" placeholder="Image URL (Cloud/Imgur/Pexels link)" required>
<button type="submit" class="add-btn">Save Product</button>
</form>

<table>
<thead>
<tr>
<th>ID</th><th>Name</th><th>Price</th><th>Category</th><th>Image URL</th><th>Actions</th>
</tr>
</thead>
<tbody id="productTable"></tbody>
</table>
</div>

<script>
const API_URL = "https://api.sheetbest.com/sheets/07108683-4692-4aa1-9c3a-95f2845f0c37";

let editingRowNumber = null;

async function loadProducts() {
  const status = document.getElementById("statusMessage");
  status.innerHTML = "üîÑ Loading products...";

  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    const data = await res.json();
    
    const table = document.getElementById("productTable");
    table.innerHTML = "";

    if (data.length === 0) {
      status.innerHTML = "üì≠ No products found in the sheet";
      return;
    }

    data.forEach((p, index) => {
      const rowNumber = index + 1;
      table.innerHTML += `
        <tr>
          <td>${p.id || '-'}</td>
          <td>${p.name || ''}</td>
          <td>${p.price || ''}</td>
          <td>${p.category || ''}</td>
          <td style="max-width:200px;word-break:break-all;">${p.image ? '<a href="'+p.image+'" target="_blank">View</a>' : '-'}</td>
          <td>
            <button class="edit-btn" onclick="editProduct(${rowNumber}, '${p.id || ''}','${p.name || ''}','${p.price || ''}','${p.category || ''}','${p.image || ''}')">Edit</button>
            <button class="delete-btn" onclick="deleteProduct(${rowNumber})">Delete</button>
          </td>
        </tr>`;
    });

    status.innerHTML = `‚úÖ ${data.length} products loaded successfully`;
  } catch (err) {
    console.error(err);
    document.getElementById("statusMessage").innerHTML = 
      `‚ùå Error loading products<br><small>${err.message}</small>`;
  }
}

document.getElementById("productForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const status = document.getElementById("statusMessage");
  status.innerHTML = "üíæ Saving...";

  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value.trim();
  const category = document.getElementById("category").value;
  const image = document.getElementById("image").value.trim();

  if (!name || !price || !image) {
    status.innerHTML = "‚ö†Ô∏è ‡∂±‡∂∏, ‡∂∏‡∑í‡∂Ω, ‡∂ª‡∑ñ‡∂¥ URL ‡∂î‡∂ö‡∑ä‡∂ö‡∑ú‡∂∏ ‡∂Ø‡∑è‡∂±‡∑ä‡∂±!";
    return;
  }

  const product = {
    id: document.getElementById("productId").value || Date.now().toString(),
    name, price, category, image
  };

  let url = API_URL;
  let method = "POST";
  if (editingRowNumber !== null) {
    url = `${API_URL}/${editingRowNumber}`;
    method = "PUT";
  }

  try {
    const res = await fetch(url, {
      method: method,
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(product)
    });

    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    this.reset();
    editingRowNumber = null;
    status.innerHTML = "‚úÖ Product saved successfully!";
    loadProducts();
  } catch (err) {
    status.innerHTML = `‚ùå Save failed: ${err.message}`;
  }
});

function editProduct(rowNumber, id, name, price, category, image) {
  editingRowNumber = rowNumber;
  document.getElementById("productId").value = id;
  document.getElementById("name").value = name;
  document.getElementById("price").value = price;
  document.getElementById("category").value = category;
  document.getElementById("image").value = image;
}

async function deleteProduct(rowNumber) {
  if (!confirm("‡∂∏‡∑ö product ‡∂ë‡∂ö ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±‡∂Ø?")) return;

  const status = document.getElementById("statusMessage");
  status.innerHTML = "üóë Deleting...";

  try {
    const res = await fetch(`${API_URL}/${rowNumber}`, { method: "DELETE" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    status.innerHTML = "‚úÖ Product deleted successfully!";
    loadProducts();
  } catch (err) {
    status.innerHTML = `‚ùå Delete failed: ${err.message}`;
  }
}

loadProducts();
</script>
</body>
</html>
